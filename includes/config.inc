<?php
/**
 * @file
 * Form and utilities used in islandora_matomo configurations.
 */

function islandora_matomo_admin_settings() {
  $form['islandora_matomo_url'] = array(
    '#title' => t("Matomo API endpoint"),
    '#type' => 'textfield',
    '#size' => 60,
    '#default_value' => variable_get('islandora_matomo_url', 'http://matomo.example.com'),
    '#description' => t("Your Matomo instance's URL"),
    '#maxlength' => 255,
  );
  $form['islandora_matomo_site_id'] = array(
    '#title' => t('Site ID'),
    '#type' => 'textfield',
    '#size' => 5,
    '#default_value' => variable_get('islandora_matomo_site_id', '1'),
    '#description' => t("The Piwik site ID."),
    '#maxlength' => 5,
  );
  $form['islandora_matomo_author_solrfield'] = array(
    '#title' => t('Solr field containing a list of authors'),
    '#type' => 'textfield',
    '#size' => 128,
    '#default_value' => variable_get('islandora_matomo_author_solrfield', 'dc.author'),
    '#maxlength' => 128,
  );

  $form['islandora_matomo_department_solrfield'] = array(
    '#title' => t('Solr field containing a list of departments'),
    '#type' => 'textfield',
    '#size' => 128,
    '#default_value' => variable_get('islandora_matomo_department_solrfield', 'dc.department'),
    '#maxlength' => 128,
  );

  $form['islandora_matomo_collection_site_ids'] = array(
    '#title' => t('Collection-specific site IDs'),
    '#type' => 'textarea',
    '#size' => 5,
    '#default_value' => variable_get('islandora_matomo_collection_site_ids', ''),
    '#description' => t("Piwik site IDs for specific collections, one entry per
      row. Each row should be in PID, site ID format
      (e.g., \"islandora:mycollection, 5\"). Multiple collections can be
      associated with the same site ID."),
  );

  $form['islandora_matomo_track_collection_usage'] = array(
    '#type' => 'checkbox',
    '#title' => t('Track collection usage'),
    '#default_value' => variable_get('islandora_matomo_track_collection_usage', 1),
    '#description' => t("Check this option if you want to track collection usage
      in addtion to object usage. If enabled, each object's parent collections
      are counted every time the object is viewed, and usage reports will be
      available under \"Visitors > Custom Variables\" in your Matomo server.
      High-traffic or large sites may want to disable this option to improve
      performance."),
  );
  $form['islandora_matomo_api_key'] = array(
    '#title' => t("Matomo API key"),
    '#type' => 'textfield',
    '#size' => 40,
    '#default_value' => variable_get('islandora_matomo_api_key', ''),
    '#description' => t("Your Matomo's API key (a.k.a. token_auth). Required if you want to view reports generated by Matomo. It it available under your account on the Matomo server, in the API menu."),
    '#maxlength' => 40,
  );
  $form['islandora_matomo_javascript_tracking_code'] = array(
    '#title' => t('Matomo JavaScript tracking code'),
    '#type' => 'textarea',
    '#size' => 5,
    '#default_value' => variable_get('islandora_matomo_javascript_tracking_code', ''),
    '#description' => t("If you want to use Matomo to provide analytics for your entire
      Islandora site, enter the \"JavaScript Tracking Code\" generated by Matomo here.
      Note that if you update any of the options provided by Matomo, you will need to
      update this JavaScript code. Islandora objects are not counted twice."),
  );

  return system_settings_form($form);
}